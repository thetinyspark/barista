(()=>{"use strict";var t={570:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BLOB_TYPE=e.JSON_TYPE=e.SOUND_TYPE=e.VIDEO_TYPE=e.IMAGE_TYPE=e.LOAD_SUCCESS=e.LOAD_ERROR=void 0;const r=s(5003);class i extends r.Emitter{uris=new Map;data;list;constructor(){super(),this.data=new Map,this.list=[]}getAll(){return this.data}queue(t,s=e.JSON_TYPE,r){this.list.push({uri:t,type:s,alias:r})}getQueue(){return this.list}freeQueue(){this.list=[]}loadQueue(){return Promise.all(this.list.map((t=>this.load(t.uri,t.type,t.alias)))).then((t=>(this.freeQueue(),t)))}getUris(){const t={};return this.uris.forEach(((e,s)=>{t[s]=e})),t}getUri(t){return this.uris.get(t)}get(t){return this.data.get(t)}load(t,s=e.JSON_TYPE,r){return this._loadBlob(t).then((t=>{switch(s){case e.IMAGE_TYPE:return i.blobToImage(t).catch(this._errorHandler);case e.JSON_TYPE:return i.blobToJSON(t).catch(this._errorHandler);case e.VIDEO_TYPE:return i.blobToVideo(t).catch(this._errorHandler);case e.SOUND_TYPE:return i.blobToSound(t).catch(this._errorHandler);default:return t}})).then((s=>(this.set(s,r,t),this.emit(e.LOAD_SUCCESS,s),s)))}set(t,e,s=""){this.uris.set(e,s),this.data.set(e,t)}delete(t){return this.getAll().delete(t)}destroy(){this.getAll().clear()}_errorHandler=t=>{this.emit(e.LOAD_ERROR,t)};_loadBlob(t){return fetch(t).then((t=>{if(200===t.status)return t.blob();this._errorHandler(t.statusText)})).catch(this._errorHandler)}static blobToSound(t){return new Promise(((e,s)=>{const r=document.createElement("audio"),i=URL.createObjectURL(t),n=t=>{r.removeEventListener("loadeddata",n),r.removeEventListener("error",o),e(r)},o=t=>{r.removeEventListener("loadeddata",n),r.removeEventListener("error",o),s("unable to load audio from source")};r.addEventListener("loadeddata",n),r.addEventListener("error",o),r.src=i,r.load()}))}static blobToJSON(t){return new Promise((e=>{const s=new FileReader;s.addEventListener("load",(()=>{e(JSON.parse(s.result.toString()))})),s.readAsText(t,"utf8")}))}static blobToImage(t){return new Promise(((e,s)=>{const r=new Image,i=t=>{r.removeEventListener("load",n),r.removeEventListener("error",i),s("unable to load image from source")},n=t=>{r.removeEventListener("load",n),r.removeEventListener("error",i),e(r)};r.addEventListener("load",n),r.addEventListener("error",i);const o=URL.createObjectURL(t);r.src=o}))}static blobToVideo(t){return new Promise(((e,s)=>{const r=document.createElement("video"),i=URL.createObjectURL(t),n=t=>{r.removeEventListener("loadeddata",n),r.removeEventListener("error",o),e(r)},o=t=>{r.removeEventListener("loadeddata",n),r.removeEventListener("error",o),s("unable to load video from source")};r.addEventListener("loadeddata",n),r.addEventListener("error",o),r.src=i,r.load()}))}}e.default=i,e.LOAD_ERROR="LOAD_ERROR",e.LOAD_SUCCESS="LOAD_SUCCESS",e.IMAGE_TYPE="IMAGE_TYPE",e.VIDEO_TYPE="VIDEO_TYPE",e.SOUND_TYPE="SOUND_TYPE",e.JSON_TYPE="JSON_TYPE",e.BLOB_TYPE="BLOB_TYPE"},5983:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VIDEO_TYPE=e.SOUND_TYPE=e.LOAD_SUCCESS=e.LOAD_ERROR=e.JSON_TYPE=e.IMAGE_TYPE=e.BLOB_TYPE=e.AssetsManager=void 0;const r=s(570);e.AssetsManager=r.default,Object.defineProperty(e,"BLOB_TYPE",{enumerable:!0,get:function(){return r.BLOB_TYPE}}),Object.defineProperty(e,"IMAGE_TYPE",{enumerable:!0,get:function(){return r.IMAGE_TYPE}}),Object.defineProperty(e,"JSON_TYPE",{enumerable:!0,get:function(){return r.JSON_TYPE}}),Object.defineProperty(e,"LOAD_ERROR",{enumerable:!0,get:function(){return r.LOAD_ERROR}}),Object.defineProperty(e,"LOAD_SUCCESS",{enumerable:!0,get:function(){return r.LOAD_SUCCESS}}),Object.defineProperty(e,"SOUND_TYPE",{enumerable:!0,get:function(){return r.SOUND_TYPE}}),Object.defineProperty(e,"VIDEO_TYPE",{enumerable:!0,get:function(){return r.VIDEO_TYPE}})},6033:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GamePadTouchEvent=void 0;const r=s(5003);class i extends r.Emitter{_touches=[];_pressed=[];setTouches(t){this._touches=t}getTouches(){return this._touches}getTouchByKey(t){return this.getTouches().find((e=>e.key===t))||null}getTouchByValue(t){return this.getTouches().find((e=>e.value===t))||null}getPressedTouches(){return this._pressed}press(t,e=0){t.press(e),this._pressed.includes(t)||(this._pressed.push(t),this.emit(n.PRESS_KEY,t))}release(t,e=0){if(this._pressed.indexOf(t)>-1){this._pressed.splice(this._pressed.indexOf(t),1);const s=t.release(e);return this.emit(n.PRESS_KEY,t),s}return t.getElapsedTime()}}var n;e.default=i,function(t){t.PRESS_KEY="PRESS_KEY",t.RELEASE_KEY="RELEASE_KEY"}(n=e.GamePadTouchEvent||(e.GamePadTouchEvent={}))},5504:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{_pressing=!1;_timestamp=0;value;key;constructor(t="",e=""){this.value=e,this.key=t}get pressing(){return this._pressing}getElapsedTime(t=0){return this.pressing?t-this._timestamp:0}release(t=0){const e=this.getElapsedTime(t);return this._pressing=!1,e}press(t=0){this._pressing=!0,this._timestamp=t}}},4630:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MouseControlEvent=void 0;const r=s(2843),i=s(2727);var n;e.default=class{_stage;_lastTouch=0;constructor(t){this._stage=t}activate(){this.deactivate(),this._stage.getCanvas().addEventListener("click",this._handler),this._stage.getCanvas().addEventListener("mouseup",this._handler),this._stage.getCanvas().addEventListener("mousedown",this._handler),this._stage.getCanvas().addEventListener("mousemove",this._handler),this._stage.getCanvas().addEventListener("touchstart",this._touchHandler),this._stage.getCanvas().addEventListener("touchend",this._touchHandler),this._stage.getCanvas().addEventListener("touchmove",this._touchHandler)}deactivate(){this._stage.getCanvas().removeEventListener("click",this._handler),this._stage.getCanvas().removeEventListener("mouseup",this._handler),this._stage.getCanvas().removeEventListener("mousedown",this._handler),this._stage.getCanvas().removeEventListener("mousemove",this._handler),this._stage.getCanvas().removeEventListener("touchstart",this._touchHandler),this._stage.getCanvas().removeEventListener("touchend",this._touchHandler),this._stage.getCanvas().removeEventListener("touchmove",this._touchHandler)}_touchHandler=t=>{const e=this._stage.getCanvas().getBoundingClientRect(),s=0==t.touches.length?t.changedTouches[0].clientX:t.touches[0].clientX,r=0==t.touches.length?t.changedTouches[0].clientY:t.touches[0].clientY,i=s-e.x>>0,o=r-e.y>>0;switch(t.preventDefault(),t.type){case"touchstart":this.dispatchAt(i,o,n.MOUSE_CONTROL_DOWN);break;case"touchend":this.dispatchAt(i,o,n.MOUSE_CONTROL_UP);break;case"touchmove":this.dispatchAt(i,o,n.MOUSE_CONTROL_MOVE)}"touchstart"==t.type?this._lastTouch=Date.now():"touchend"==t.type&&Date.now()-this._lastTouch<135&&(this.dispatchAt(i,o,n.MOUSE_CONTROL_CLICK),this._lastTouch=Date.now())};_handler=t=>{const e=this._stage.getCanvas().getBoundingClientRect(),s=t.clientX-e.x>>0,r=t.clientY-e.y>>0;switch(t.type){case"click":this.dispatchAt(s,r,n.MOUSE_CONTROL_CLICK);break;case"mouseup":this.dispatchAt(s,r,n.MOUSE_CONTROL_UP);break;case"mousedown":this.dispatchAt(s,r,n.MOUSE_CONTROL_DOWN);break;case"mousemove":this.dispatchAt(s,r,n.MOUSE_CONTROL_MOVE)}};_getObjectUnderPointRecursive(t,e,s){const n=s.getChildren();let o=n.length;for(;--o>-1;){const s=n[o];if(i.isDisplayObjectContainer(s)){const r=this._getObjectUnderPointRecursive(t,e,s);if(null!==r)return r}else if(s.mouseEventsEnabled&&r.default.collide(t,e,s))return s}return null}dispatchAt(t,e,s){const r=this._getObjectUnderPointRecursive(t,e,this._stage),i=null===r?this._stage:r;let n=i;for(;null!==n;)n.emit(s,{x:t,y:e,target:i}),n=n.parent}},function(t){t.MOUSE_CONTROL_CLICK="MOUSE_CONTROL_CLICK",t.MOUSE_CONTROL_MOVE="MOUSE_CONTROL_MOVE",t.MOUSE_CONTROL_UP="MOUSE_CONTROL_UP",t.MOUSE_CONTROL_DOWN="MOUSE_CONTROL_DOWN"}(n=e.MouseControlEvent||(e.MouseControlEvent={}))},7392:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GamePadTouchEvent=e.GamePadTouch=e.GamePad=e.MouseControlEvent=e.MouseControl=void 0;const r=s(4630);e.MouseControl=r.default,Object.defineProperty(e,"MouseControlEvent",{enumerable:!0,get:function(){return r.MouseControlEvent}});const i=s(6033);e.GamePad=i.default,Object.defineProperty(e,"GamePadTouchEvent",{enumerable:!0,get:function(){return i.GamePadTouchEvent}});const n=s(5504);e.GamePadTouch=n.default},5165:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationEvent=void 0;const r=s(1610),i=s(4870),n=s(5055);class o extends n.default{_frames=[];_currentFrameIndex=0;_playing=!1;_forwarding=!0;loop=!1;constructor(){super(),this.addChild(new i.default)}play(){this._playing=!0,this._forwarding=!0}rewind(){this._playing=!0,this._forwarding=!1}stop(){this._playing=!1}render(t){if(super.render(t),this._playing){const t=this._forwarding?1:-1;this.goToFrame(this._currentFrameIndex+t)}}clearFrames(){this._currentFrameIndex=0,this._frames=[]}setFrameAt(t,e){e.index=t,this._frames[t]=e}getFrameAt(t){return this._frames[t]||null}getCurrentFrame(){let t=this.getFrameAt(this.getCurrentFrameIndex());return null===t&&this._forwarding?t=this.getPreviousDefinedFrameAt(this.getCurrentFrameIndex()):null!==t||this._forwarding||(t=this.getNextDefinedFrameAt(this.getCurrentFrameIndex())),t}getPreviousDefinedFrameAt(t){let e=null;for(;null===e&&t>-1;)e=this.getFrameAt(t--);return e}getNextDefinedFrameAt(t){let e=null;for(;null===e&&t<=this.getLastFrameIndex();)e=this.getFrameAt(t++);return e}removeFrameAt(t){this._frames[t]=null}getAnimationLength(){return this._frames.length}getLastFrameIndex(){return this.getAnimationLength()-1}getCurrentFrameIndex(){return this._currentFrameIndex}goToFrame(t){t=this.loop?(t=t>this.getLastFrameIndex()?0:t)<0?this.getLastFrameIndex():t:(t=t>this.getLastFrameIndex()?this.getLastFrameIndex():t)<0?0:t,this._currentFrameIndex=t;const e=this.getCurrentFrame(),s=this.getChildren()[0];s.texture=e.texture,s.width=e.width,s.height=e.height,s.x=e.offsetX,s.y=e.offsetY,s.update(this.worldMatrix,this.worldOpacity),this.emit(a.PLAY_FRAME,this._currentFrameIndex)}static createFromTexturesAndFrames(t){const e=new o;return t.forEach((t=>{const s=new r.default;s.width=t.texture.sw,s.height=t.texture.sh,s.originalWidth=s.width,s.originalHeight=s.height,s.texture=t.texture,e.setFrameAt(t.frame,s)})),e}}var a;e.default=o,function(t){t.PLAY_FRAME="PLAY_FRAME"}(a=e.AnimationEvent||(e.AnimationEvent={}))},1610:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{name="";index=0;width=0;height=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0;texture=null}},528:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(4870),i=s(2843);class n extends r.default{constructor(){super()}getRevertWorldMatrix(){return i.default.getRevertWorldMatrix(this.worldMatrix)}getBounds(){return i.default.getBoundingRect(this)}}e.default=n},4870:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(925),i=s(5003),n=s(2041),o=s(351);class a extends i.Emitter{filters=[];texture=null;worldMatrix=r.mat2d.create();matrix=r.mat2d.create();x=0;y=0;opacity=1;worldOpacity=1;scaleX=1;scaleY=1;rotation=0;width=0;height=0;transformOrigin={x:0,y:0};parent=null;visible=!0;name="";mouseEventsEnabled=!0;snapshot(){const t=new n.default,e=this.matrix,s=this.worldMatrix,i=t.getCanvas(),o=t.getContext();return r.mat2d.identity(this.matrix),r.mat2d.identity(this.worldMatrix),i.width=this.width,i.height=this.height,t.add(this),t.draw(i,o),this.matrix=e,this.worldMatrix=s,t.getCanvas()}update(t,e=1){o.Geometry.updateTransform(t,this),this.opacity>1&&(this.opacity=1),this.opacity<0&&(this.opacity=0),this.worldOpacity=e*this.opacity}render(t){this.visible&&t.add(this)}static createFromTexture(t){const e=new a;return e.width=t.sw,e.height=t.sh,e.texture=t,e}}e.default=a},5055:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(4870);class i extends r.default{_children=[];addChild(t){this.contains(t)&&this.removeChild(t),this._children.push(t),t.parent=this}removeChild(t){const e=this.getChildIndex(t);return this.removeChildAt(e)}addChildAt(t,e){this.contains(t)&&this.removeChild(t);const s=this._children.splice(0,e);t.parent=this,this._children=[...s,t,...this._children]}removeChildAt(t){const e=this._children[t]||null;if(null===e)throw new Error("out of bound index for removeChildAt");return this._children.splice(t,1),e.parent=null,e}getChildren(){return this._children}getAllNestedChildrenIterative(){let t=[],e=[];for(e.push(this);e.length>0;){const s=e.shift(),r=t.indexOf(s)+1,i=t.splice(r);for(let r=0;r<s._children.length;r++){const i=s._children[r];t.push(i),void 0!==i.getChildren&&e.push(i)}t=t.concat(i)}return t}getAllNestedChildren(t=[]){for(let e=0;e<this._children.length;e++){const s=this._children[e];t.push(s),void 0!==s.getChildren&&s.getAllNestedChildren(t)}return t}getChildIndex(t){return this._children.indexOf(t)}contains(t){return t.parent===this&&this.getChildIndex(t)>-1}removeChildren(){for(;this._children.length>0;)this.removeChildAt(0)}update(t,e){super.update(t,e),this._children.forEach((t=>{t.update(this.worldMatrix,this.worldOpacity)}))}render(t){super.render(t),this.visible&&this._children.forEach((e=>{e.render(t)}))}}e.default=i},7632:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StageEvent=void 0;const r=s(925),i=s(2041),n=s(5055);class o extends n.default{_camera=null;_currentFrame=0;_renderer=new i.default;_clippingStrategy=null;autoUpdateMatrices=!0;constructor(){super()}setCamera(t){this._camera=t}getCamera(){return this._camera}setClippingStrategy(t){this._clippingStrategy=t}getClippingStrategy(){return this._clippingStrategy}getRenderer(){return this._renderer}setRenderer(t){this._renderer=t}getCanvas(){return this._renderer.getCanvas()}getContext(){return this._renderer.getContext()}getCurrentFrame(){return this._currentFrame}nextFrame(){this._currentFrame++,this.emit(a.ENTER_FRAME,this._currentFrame),!0===this.autoUpdateMatrices&&this.update(r.mat2d.create(),1),null!==this._clippingStrategy&&null!==this._camera&&this._clippingStrategy(this,this._camera),this._renderer.clear(),this.render(this._renderer),this._renderer.draw(this._renderer.getCanvas(),this._renderer.getContext()),this.emit(a.FRAME_END,this._currentFrame)}update(t,e){null!==this._camera&&(this._camera.update(t,1),t=this._camera.getRevertWorldMatrix()),super.update(t,e)}}var a;e.default=o,function(t){t.ENTER_FRAME="ENTER_FRAME",t.FRAME_END="FRAME_END"}(a=e.StageEvent||(e.StageEvent={}))},2359:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(7632),i=s(4870),n=s(5590),o=s(1057),a=s(5590);class h extends i.default{_stage=null;_lastFrameTime=0;_monitoring=!1;_elapsedTime=0;_context;constructor(){super();const t=a.CanvasUtils.create();this.width=t.width=450,this.height=t.height=50,this.texture=new n.Texture("stats_texture",new o.default(t),0,0,t.width,t.height),this.texture.data.isDynamic=!0,this._context=this.texture.source.getContext("2d")}getStage(){return this._stage}setStage(t){this.stop(),this._stage=t}start(){null!==this._stage&&this._stage.subscribe(r.StageEvent.ENTER_FRAME,this._enterFrame),this._monitoring=!0}stop(){null!==this._stage&&this._stage.unsubscribe(r.StageEvent.ENTER_FRAME,this._enterFrame),this._monitoring=!1}getFps(){return this._monitoring?Math.round(1e3/this._elapsedTime):-1}_enterFrame=t=>{this._elapsedTime=(new Date).getTime()-this._lastFrameTime,this._lastFrameTime=(new Date).getTime();const e=t.getPayload(),s=this._stage.getRenderer().getNumDrawCalls(),r=this._stage.getRenderer().getChildren().length;if(e%60==0){const t="fps: "+this.getFps()+", frame: "+e+", drawCalls: "+s+", quads: "+r,i=this._context;i.beginPath(),i.fillStyle="black",i.fillRect(0,0,this.width,this.height),i.fill(),i.font="20px Arial",i.fillStyle="red",i.fillText(t,0,Math.round(this.height/2)),i.closePath()}}}e.default=h},5850:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=e.Stats=e.StageEvent=e.Stage=e.DisplayObjectContainer=e.DisplayObject=e.AnimationEvent=e.Animation=void 0;const r=s(5165);e.Animation=r.default,Object.defineProperty(e,"AnimationEvent",{enumerable:!0,get:function(){return r.AnimationEvent}});const i=s(4870);e.DisplayObject=i.default;const n=s(5055);e.DisplayObjectContainer=n.default;const o=s(7632);e.Stage=o.default,Object.defineProperty(e,"StageEvent",{enumerable:!0,get:function(){return o.StageEvent}});const a=s(2359);e.Stats=a.default;const h=s(528);e.Camera=h.default},4849:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},2041:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(5590);e.default=class{_children=[];_canvas;_context;constructor(){this._canvas=r.CanvasUtils.create(),this._context=this._canvas.getContext("2d")}getNumDrawCalls(){return this._children.length}getContext(){return this._context}getCanvas(){return this._canvas}add(t){this._children.push(t)}getChildren(){return this._children}setChildren(t){this._children=t}clear(){this._children=[]}draw(t,e){e.clearRect(0,0,t.width,t.height),this._children.forEach((t=>{if(null===t.texture)return;const s=t.worldMatrix;e.save(),e.globalAlpha=t.worldOpacity,e.setTransform(s[0],s[1],s[2],s[3],s[4],s[5]),e.drawImage(t.texture.source,t.texture.sx,t.texture.sy,t.texture.sw,t.texture.sh,0,0,t.width,t.height),e.restore()}))}}},4367:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas2DRenderer=void 0;const r=s(2041);e.Canvas2DRenderer=r.default},9279:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},6902:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(5590),i=s(5590),n=s(5050),o=s(9319);e.default=class{_width=0;_height=0;_zones=[];_textures=[];_textureData=null;constructor(t,e,s=[]){this._reset(t,e,s)}_sortZonesByAreaAsc(t,e){return t.getArea()>e.getArea()?-1:1}_sortSourcesByAreaAsc(t,e){return t.source.width*t.source.height>e.source.width*e.source.height?-1:1}_drawTextures(){const t=i.CanvasUtils.create(this._width,this._height),e=r.Texture.createFromSource("main",t),s=e.data.getSource().getContext("2d"),n=this.getZones().filter((t=>!t.isEmpty())),o=n.map((t=>({id:t.data.id,sx:t.x,sy:t.y,sw:t.width,sh:t.height})));return n.forEach((t=>{s.save(),s.drawImage(t.data.source,t.x,t.y,t.width,t.height),s.restore()})),this._textureData=e.data,e.createSubTextures(o)}_addSource(t){const e=this._findFreeZoneFor(t.source);if(null===e)return!1;let s=null,r=null;return t.source.width>t.source.height?(s=e.splitBottom(t.source.height),r=e.splitRight(t.source.width)):(r=e.splitRight(t.source.width),s=e.splitBottom(t.source.height)),e.data=t,null!==r&&r.getArea()>0&&this._zones.push(r),null!==s&&s.getArea()>0&&this._zones.push(s),!0}_findFreeZoneFor(t){return this._zones.sort(this._sortZonesByAreaAsc),this._zones.find((e=>e.canContain(t.width,t.height)&&e.isEmpty()))||null}_reset(t,e,s){this._width=n.default.getNextPowerOf2(t),this._height=n.default.getNextPowerOf2(e);const r=new o.default;r.x=0,r.y=0,r.width=this._width,r.height=this._height,r.data=null,this._zones=[r],s.sort(this._sortSourcesByAreaAsc),s.forEach((t=>{this._addSource(t)})),this._textures=this._drawTextures()}getTextureData(){return this._textureData}getTextures(){return this._textures}getZones(){return this._zones}getWidth(){return this._width}getHeight(){return this._height}}},5827:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(1057);class i{_data;sx=0;sy=0;sw=0;sh=0;topLeftUv={u:0,v:0};topRightUv={u:0,v:0};bottomLeftUv={u:0,v:0};bottomRightUv={u:0,v:0};id="";constructor(t="",e,s=0,r=0,i=0,n=0){this._data=e,this.sx=s,this.sy=r,this.sw=i,this.sh=n,this.id=t,this.calcUv()}calcUv(){const t=this._data.getSource().width,e=this._data.getSource().height,s=this.sx/t,r=(this.sx+this.sw)/t,i=this.sy/e,n=(this.sy+this.sh)/e;this.topLeftUv.u=s,this.topLeftUv.v=i,this.topRightUv.u=r,this.topRightUv.v=i,this.bottomLeftUv.u=s,this.bottomLeftUv.v=n,this.bottomRightUv.u=r,this.bottomRightUv.v=n}get textureUid(){return this._data.uid}get data(){return this._data}get source(){return this._data.getSource()}createSubTexture(t,e,s,r,n){return new i(t,this._data,e,s,r,n)}createSubTextures(t){return t.map((t=>this.createSubTexture(t.id,t.sx,t.sy,t.sw,t.sh)))}static createFromSource(t,e){const s=new r.default(e);return e instanceof HTMLVideoElement&&(s.isDynamic=!0),new i(t,s,0,0,s.width,s.height)}}e.default=i},1057:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(5590),i=s(5050);class n{width=0;height=0;texturePos=0;_source;_uid;_glTexture=null;_isDynamic=!1;_updateNextFrame=!1;static _counter=0;constructor(t){this.setSource(t),this._uid="texture_data_"+n._counter++}setSource(t){const e=i.default.getNextPowerOf2(t.width),s=i.default.getNextPowerOf2(t.height),n=r.CanvasUtils.create(),o=n.getContext("2d");n.width=e,n.height=s,o.drawImage(t,0,0),this._source=n,this.width=e,this.height=s,this._updateNextFrame=!0}getSource(){return this._source}getGlTexture(t){return null===this._glTexture&&(this._glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,null)),(this._isDynamic||this._updateNextFrame)&&(this._updateNextFrame=!1,t.bindTexture(t.TEXTURE_2D,this._glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._source)),this._glTexture}get uid(){return this._uid}get isDynamic(){return this._isDynamic}set isDynamic(t){this._isDynamic=t}}e.default=n},9319:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{x;y;width;height;data=null;isEmpty(){return null===this.data}_partialClone(){const t=new s;return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}splitRight(t){if(t>=this.width)return null;const e=this._partialClone();return e.x+=t,e.width-=t,this.width=t,e}splitLeft(t){if(t>=this.width)return null;const e=this._partialClone();return this.x+=t,this.width-=t,e.width=t,e}splitBottom(t){if(t>=this.height)return null;const e=this._partialClone();return e.y+=t,e.height-=t,this.height=t,e}splitTop(t){if(t>=this.height)return null;const e=this._partialClone();return this.y+=t,this.height-=t,e.height=t,e}getArea(){return this.width*this.height}canContain(t,e){return t<=this.width&&e<=this.height}}e.default=s},1940:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Zone=e.TextureData=e.Texture=e.Spritesheet=void 0;const r=s(6902);e.Spritesheet=r.default;const i=s(5827);e.Texture=i.default;const n=s(1057);e.TextureData=n.default;const o=s(9319);e.Zone=o.default},978:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{static create(t=1,e=1){const s=document.createElement("canvas");return s.width=t,s.height=e,s}static fillRect(t,e,s,r,i,n){const o=t.getContext("2d");o.save(),o.beginPath(),o.fillStyle=e,o.fillRect(s,r,i,n),o.fill(),o.closePath(),o.restore()}static getCanvasPixels(t){const e=s.create(t.width,t.height);return e.getContext("2d").drawImage(t,0,0),e.getContext("2d").getImageData(0,0,e.width,e.height).data}static getCanvasPixel(t,e,r){const i=s.getCanvasPixels(t),n=Math.floor(r*t.width*4)+4*e;return[i[n],i[n+1],i[n+2],i[n+3]]}static canvasPixelToRGBA(t){return{r:t[0],g:t[1],b:t[2],a:t[3]}}static pixelsAreTheSame(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}}e.default=s},2843:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(925),i=s(2727);class n{static TO_RADIANS=Math.PI/180;static FAST_ANGLES=n.getFastAngle();static FAST_SIN=n.getFastSinus();static FAST_COS=n.getFastCosinus();static getFastAngle(){const t=[];for(let e=0;e<=360;e++)t.push(e*this.TO_RADIANS);return t}static getFastSinus(){const t=this.getFastAngle();for(let e=0;e<t.length;e++)t[e]=Math.sin(e*this.TO_RADIANS);return t}static getFastCosinus(){const t=this.getFastAngle();for(let e=0;e<t.length;e++)t[e]=Math.cos(e*this.TO_RADIANS);return t}static updateTransformAll(t,e){let s=t[0],i=t[1],o=t[2],a=t[3],h=t[4],l=t[5],u=r.mat2d.create(),d=r.mat2d.create(),c=r.mat2d.create(),g=null,_=null,f=0,m=0,p=0,y=0,x=0,w=0,E=0;for(let r=0;r<e.length;r++)g=e[r],d=g.matrix,c=g.worldMatrix,f=(g.rotation%360+360)%360>>0,m=n.FAST_SIN[f],p=n.FAST_COS[f],y=g.transformOrigin.x>>0,x=g.transformOrigin.y>>0,w=g.scaleX,E=g.scaleY,d[0]=p*w,d[1]=m*w,d[2]=-m*E,d[3]=p*E,d[4]=d[0]*-y+d[2]*-x+g.x+y,d[5]=d[1]*-y+d[3]*-x+g.y+x,g.parent!==_&&(u=null!==g.parent?g.parent.worldMatrix:t,_=g.parent,s=u[0],i=u[1],o=u[2],a=u[3],h=u[4],l=u[5]),c[0]=s*d[0]+o*d[1],c[1]=i*d[0]+a*d[1],c[2]=s*d[2]+o*d[3],c[3]=i*d[2]+a*d[3],c[4]=s*d[4]+o*d[5]+h,c[5]=i*d[4]+a*d[5]+l}static updateTransform(t,e){const s=e.matrix,r=e.worldMatrix,i=e.rotation<0?(360+e.rotation>>0)%360:(e.rotation>>0)%360;let n=s[0],o=s[1],a=s[2],h=s[3],l=s[4],u=s[5],d=t[0],c=t[1],g=t[2],_=t[3],f=t[4],m=t[5],p=0,y=0,x=0,w=0;s[0]=1,s[1]=0,s[2]=0,s[3]=1,s[4]=e.x+e.transformOrigin.x>>0,s[5]=e.y+e.transformOrigin.y>>0,n=s[0],o=s[1],a=s[2],h=s[3],l=s[4],u=s[5],p=this.FAST_SIN[i],y=this.FAST_COS[i],s[0]=n*y+a*p,s[1]=o*y+h*p,s[2]=n*-p+a*y,s[3]=o*-p+h*y,s[4]=l,s[5]=u,n=s[0],o=s[1],a=s[2],h=s[3],l=s[4],u=s[5],x=e.scaleX,w=e.scaleY,s[0]=n*x,s[1]=o*x,s[2]=a*w,s[3]=h*w,s[4]=l,s[5]=u,n=s[0],o=s[1],a=s[2],h=s[3],l=s[4],u=s[5],x=-e.transformOrigin.x>>0,w=-e.transformOrigin.y>>0,s[0]=n,s[1]=o,s[2]=a,s[3]=h,s[4]=n*x+a*w+l,s[5]=o*x+h*w+u,d=s[0],c=s[1],g=s[2],_=s[3],f=s[4],m=s[5],n=t[0],o=t[1],a=t[2],h=t[3],l=t[4],u=t[5],r[0]=n*d+a*c,r[1]=o*d+h*c,r[2]=n*g+a*_,r[3]=o*g+h*_,r[4]=n*f+a*m+l,r[5]=o*f+h*m+u}static getHitbox(t){if(i.isDisplayObjectContainer(t)){const e=t.getChildren().map((t=>this.getHitbox(t))),s=[],r=[];e.forEach((t=>{s.push(t.topLeft.x,t.topRight.x,t.bottomLeft.x,t.bottomRight.x),r.push(t.topLeft.y,t.topRight.y,t.bottomLeft.y,t.bottomRight.y)}));const i=Math.min(...s),n=Math.max(...s),o=Math.min(...r),a=Math.max(...r);return{topLeft:{x:i,y:o},topRight:{x:n,y:o},bottomLeft:{x:i,y:a},bottomRight:{x:n,y:a}}}{const e=t.worldMatrix;return{topLeft:this.transformPoint(0,0,e),topRight:this.transformPoint(t.width,0,e),bottomLeft:this.transformPoint(0,t.height,e),bottomRight:this.transformPoint(t.width,t.height,e)}}}static getBoundingRect(t){const e=this.getHitbox(t),s=Math.min(e.topLeft.x,e.topRight.x,e.bottomLeft.x,e.bottomRight.x),r=Math.max(e.topLeft.x,e.topRight.x,e.bottomLeft.x,e.bottomRight.x),i=Math.min(e.topLeft.y,e.topRight.y,e.bottomLeft.y,e.bottomRight.y);return{x:s,y:i,width:r-s,height:Math.max(e.topLeft.y,e.topRight.y,e.bottomLeft.y,e.bottomRight.y)-i}}static transformPoint(t,e,s){return{x:Math.round(t*s[0]+e*s[2]+s[4]),y:Math.round(t*s[1]+e*s[3]+s[5])}}static getRevertWorldMatrix(t){const e=r.mat2d.create();return r.mat2d.invert(e,t),e}static collide(t,e,s){const r=this.getBoundingRect(s);return!(t<r.x||t>r.x+r.width||e<r.y||e>r.y+r.height)}}e.default=n},5050:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{static getNextPowerOf2(t){let e=1;for(;e<t;)e*=2;return e}}},351:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MathUtils=e.isWebGLAvailable=e.isDisplayObjectContainer=e.Geometry=e.CanvasUtils=void 0;const r=s(978);e.CanvasUtils=r.default;const i=s(2843);e.Geometry=i.default;const n=s(2727);Object.defineProperty(e,"isDisplayObjectContainer",{enumerable:!0,get:function(){return n.isDisplayObjectContainer}}),Object.defineProperty(e,"isWebGLAvailable",{enumerable:!0,get:function(){return n.isWebGLAvailable}});const o=s(5050);e.MathUtils=o.default},2727:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isWebGLAvailable=e.isDisplayObjectContainer=void 0;const r=s(5590);e.isDisplayObjectContainer=function(t){return void 0!==t.getChildren},e.isWebGLAvailable=function(){return null!==r.CanvasUtils.create().getContext("webgl")}},5590:function(t,e,s){var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||r(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),i(s(5003),e),i(s(7392),e),i(s(5850),e),i(s(4849),e),i(s(9279),e),i(s(4367),e),i(s(2576),e),i(s(5794),e),i(s(9510),e),i(s(8791),e),i(s(4499),e),i(s(1035),e),i(s(7072),e),i(s(2677),e),i(s(3407),e),i(s(8433),e),i(s(5983),e),i(s(1940),e),i(s(351),e);const n=s(925),o=s(7632),a=s(5590),h=s(5590),l=s(4870),u=s(5747);n.glMatrix.setMatrixArrayType(Array);const d=new o.default,c=a.CanvasUtils.create(100,100),g=c.getContext("2d");g.fillStyle="red",g.fillRect(0,0,100,100),g.fill();const _=h.Texture.createFromSource("red",c),f=l.default.createFromTexture(_);d.getCanvas().width=200,d.getCanvas().height=200,f.transformOrigin.x=f.width>>1,f.transformOrigin.y=f.height>>1,f.rotation=45,d.addChild(f),d.nextFrame();const m=d.getCanvas().toBuffer();u.writeFileSync("./test.png",m)},7690:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{id="";state={}}},9510:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GameNode=void 0;const r=s(7690);e.GameNode=r.default},220:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{_map=[];_numRows=0;_numCols=0;constructor(){}reset(t,e){this._numRows=t,this._numCols=e,this._map=[];for(let s=0;s<t;s++){const t=[];for(let s=0;s<e;s++)t.push(null);this._map.push(t)}}destroy(){this._map=[],this._numRows=0,this._numCols=0}getNeighbours(t,e){return{topLeft:this.getTopLeft(t,e),top:this.getTop(t,e),topRight:this.getTopRight(t,e),left:this.getLeft(t,e),center:this.getAt(t,e),right:this.getRight(t,e),bottomLeft:this.getBottomLeft(t,e),bottom:this.getBottom(t,e),bottomRight:this.getBottomRight(t,e)}}getLeft(t,e){return this.getAt(t,e-1)}getRight(t,e){return this.getAt(t,e+1)}getBottom(t,e){return this.getAt(t+1,e)}getBottomLeft(t,e){return this.getAt(t+1,e-1)}getBottomRight(t,e){return this.getAt(t+1,e+1)}getTop(t,e){return this.getAt(t-1,e)}getTopLeft(t,e){return this.getAt(t-1,e-1)}getTopRight(t,e){return this.getAt(t-1,e+1)}getAt(t,e){return this.isOutOfBounds(t,e)?null:this._map[t][e]}addAt(t,e,s){this.isOutOfBounds(t,e)||(this._map[t][e]=s)}removeAt(t,e){this.isOutOfBounds(t,e)||(this._map[t][e]=null)}isOutOfBounds(t,e){return t>this.numRows-1||e>this.numCols-1||t<0||e<0}forEach(t){for(let e=0;e<this.numRows;e++)for(let s=0;s<this.numCols;s++)t(this._map[e][s],e,s)}map(t){const e=[];for(let s=0;s<this.numRows;s++){e[s]=[];for(let r=0;r<this.numCols;r++)e[s][r]=t(this._map[s][r],s,r)}return s.from(e)}extract(t,e,r,i){const n=[];e=e>this.numRows-1?this.numRows-1:e,i=i>this.numCols-1?this.numCols-1:i,r=r<0?0:r;for(let s=t=t<0?0:t;s<=e;s++){const t=[];for(let e=r;e<=i;e++)t.push(this.getAt(s,e));n.push(t)}return s.from(n)}get numCols(){return this._numCols}get numRows(){return this._numRows}get data(){return this._map}static from(t){const e=new s,r=t.length,i=t[0]?.length||0;e.reset(r,i);for(let s=0;s<r;s++)for(let r=0;r<i;r++)e.addAt(s,r,t[s][r]);return e}}e.default=s},7569:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{_map=[];_numRows=0;_numCols=0;_numLayers=0;constructor(){}reset(t,e,s){this._numRows=t,this._numCols=e,this._numLayers=s,this._map=[];for(let r=0;r<s;r++){const s=[];this._map.push(s);for(let r=0;r<t;r++){const t=[];s.push(t);for(let s=0;s<e;s++)t.push(null)}}}destroy(){this._map=[],this._numRows=0,this._numCols=0,this._numLayers=0}getAt(t,e,s){return this.isOutOfBounds(t,e,s)?null:this._map[s][t][e]}addAt(t,e,s,r){this.isOutOfBounds(t,e,s)||(this._map[s][t][e]=r)}removeAt(t,e,s){this.isOutOfBounds(t,e,s)||(this._map[s][t][e]=null)}isOutOfBounds(t,e,s){return t>this.numRows-1||e>this.numCols-1||s>this.numLayers-1||s<0||t<0||e<0}forEach(t){for(let e=0;e<this.numLayers;e++)for(let s=0;s<this.numRows;s++)for(let r=0;r<this.numCols;r++)t(this._map[e][s][r],s,r,e)}getNeighbours(t,e,s){return{topLeftFront:this.getTopLeftFront(t,e,s),topFront:this.getTopFront(t,e,s),topRightFront:this.getTopRightFront(t,e,s),leftFront:this.getLeftFront(t,e,s),centerFront:this.getFront(t,e,s),rightFront:this.getRightFront(t,e,s),bottomLeftFront:this.getBottomLeftFront(t,e,s),bottomFront:this.getBottomFront(t,e,s),bottomRightFront:this.getBottomRightFront(t,e,s),topLeftBack:this.getTopLeftBack(t,e,s),topBack:this.getTopBack(t,e,s),topRightBack:this.getTopRightBack(t,e,s),leftBack:this.getLeftBack(t,e,s),centerBack:this.getBack(t,e,s),rightBack:this.getRightBack(t,e,s),bottomLeftBack:this.getBottomLeftBack(t,e,s),bottomBack:this.getBottomBack(t,e,s),bottomRightBack:this.getBottomRightBack(t,e,s),topLeft:this.getTopLeft(t,e,s),top:this.getTop(t,e,s),topRight:this.getTopRight(t,e,s),left:this.getLeft(t,e,s),center:this.getAt(t,e,s),right:this.getRight(t,e,s),bottomLeft:this.getBottomLeft(t,e,s),bottom:this.getBottom(t,e,s),bottomRight:this.getBottomRight(t,e,s)}}getLeftFront(t,e,s){return this.getAt(t,e-1,s-1)}getRightFront(t,e,s){return this.getAt(t,e+1,s-1)}getBottomFront(t,e,s){return this.getAt(t+1,e,s-1)}getBottomLeftFront(t,e,s){return this.getAt(t+1,e-1,s-1)}getBottomRightFront(t,e,s){return this.getAt(t+1,e+1,s-1)}getTopFront(t,e,s){return this.getAt(t-1,e,s-1)}getTopLeftFront(t,e,s){return this.getAt(t-1,e-1,s-1)}getTopRightFront(t,e,s){return this.getAt(t-1,e+1,s-1)}getFront(t,e,s){return this.getAt(t,e,s-1)}getBack(t,e,s){return this.getAt(t,e,s+1)}getLeftBack(t,e,s){return this.getAt(t,e-1,s+1)}getRightBack(t,e,s){return this.getAt(t,e+1,s+1)}getBottomBack(t,e,s){return this.getAt(t+1,e,s+1)}getBottomLeftBack(t,e,s){return this.getAt(t+1,e-1,s+1)}getBottomRightBack(t,e,s){return this.getAt(t+1,e+1,s+1)}getTopBack(t,e,s){return this.getAt(t-1,e,s+1)}getTopLeftBack(t,e,s){return this.getAt(t-1,e-1,s+1)}getTopRightBack(t,e,s){return this.getAt(t-1,e+1,s+1)}getLeft(t,e,s){return this.getAt(t,e-1,s)}getRight(t,e,s){return this.getAt(t,e+1,s)}getBottom(t,e,s){return this.getAt(t+1,e,s)}getBottomLeft(t,e,s){return this.getAt(t+1,e-1,s)}getBottomRight(t,e,s){return this.getAt(t+1,e+1,s)}getTop(t,e,s){return this.getAt(t-1,e,s)}getTopLeft(t,e,s){return this.getAt(t-1,e-1,s)}getTopRight(t,e,s){return this.getAt(t-1,e+1,s)}map(t){const e=[];for(let s=0;s<this.numLayers;s++){e[s]=[];for(let r=0;r<this.numRows;r++){e[s][r]=[];for(let i=0;i<this.numCols;i++)e[s][r][i]=t(this._map[s][r][i],r,i,s)}}return s.from(e)}extract(t,e,r,i,n,o){const a=[];o=o>this.numLayers-1?this.numLayers-1:o,e=e>this.numRows-1?this.numRows-1:e,i=i>this.numCols-1?this.numCols-1:i,t=t<0?0:t,r=r<0?0:r;for(let s=n=n<0?0:n;s<=o;s++){const n=[];for(let o=t;o<=e;o++){const t=[];for(let e=r;e<=i;e++)t.push(this.getAt(o,e,s));n.push(t)}a.push(n)}return s.from(a)}static from(t){const e=new s,r=t.length,i=t[0]?.length||0,n=t[0]?.[0]?.length||0;e.reset(i,n,r);for(let s=0;s<r;s++)for(let r=0;r<i;r++)for(let i=0;i<n;i++)e.addAt(r,i,s,t[s][r][i]);return e}get numLayers(){return this._numLayers}get numCols(){return this._numCols}get numRows(){return this._numRows}get data(){return this._map}}e.default=s},8791:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Grid3D=e.Grid2D=void 0;const r=s(220);e.Grid2D=r.default;const i=s(7569);e.Grid3D=i.default},5462:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{x;y;width;height;constructor(t=0,e=0,s=0,r=0){this.x=t,this.y=e,this.width=s,this.height=r}toString(){return"[x:"+this.x+",y:"+this.y+",width:"+this.width+",height:"+this.height+"]"}collideBox(t){return this.collidePoint(t.x,t.y)||this.collidePoint(t.x+t.width,t.y)||this.collidePoint(t.x,t.y+t.height)||this.collidePoint(t.x+t.width,t.y+t.height)||t.collidePoint(this.x,this.y)||t.collidePoint(this.x+this.width,this.y)||t.collidePoint(this.x,this.y+this.height)||t.collidePoint(this.x+this.width,this.y+this.height)}collidePoint(t,e){return!(t<this.x||e<this.y||t>this.x+this.width||e>this.y+this.height)}getMidX(){return this.x+this.width/2}getMidY(){return this.y+this.height/2}splitVertical(){return[new s(this.x,this.y,this.width/2,this.height),new s(this.getMidX(),this.y,this.width/2,this.height)]}splitHorizontal(){return[new s(this.x,this.y,this.width,this.height/2),new s(this.x,this.getMidY(),this.width,this.height/2)]}}e.default=s},4683:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{box;axis;constructor(t,e){this.box=t,this.axis=e}search(t,e,s=[]){if(t.getPartitionMethod().box.collideBox(e)){if(null!==t.getLeft())t.getLeft().search(e,s),t.getRight().search(e,s);else{const r=t.getChildren(),i=r.length;for(let t=0;t<i;t++)r[t].collideBox(e)&&s.push(r[t])}return s}}split(t){const e=[],r=[],i=t.length,n=this.box.getMidX(),o=this.box.getMidY();for(let s=0;s<i;s++){const i=t[s];"x"===this.axis?i.x>=n?r.push(i):e.push(i):i.y>=o?r.push(i):e.push(i)}const a="x"===this.axis?this.box.splitVertical():this.box.splitHorizontal(),h="x"===this.axis?"y":"x";return{left:e,right:r,leftFunction:new s(a[0],h),rightFunction:new s(a[1],h)}}}e.default=s},8955:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class s{_maxChildren;_depth;_maxDepth;_partitionMethod;parent=null;_left=null;_right=null;_children=[];constructor(t,e,s,r){this._maxChildren=t,this._depth=e,this._maxDepth=s,this._partitionMethod=r,this.reset()}search(...t){return this._partitionMethod.search(this,...t)}reset(){this._children=[],this._left=null,this._right=null}createSubNodes(){const t=this._partitionMethod.split(this.getChildren());this._left=new s(this._maxChildren,this._depth+1,this._maxDepth,t.leftFunction),this._right=new s(this._maxChildren,this._depth+1,this._maxDepth,t.rightFunction),t.left.forEach(this._left.addChild.bind(this._left)),t.right.forEach(this._right.addChild.bind(this._right)),this._left.parent=this,this._right.parent=this,this._children=[]}getChildren(){return this._children}addChild(t){if(this._children.length>=this._maxChildren&&this._depth<this._maxDepth&&this.createSubNodes(),null===this._left&&null===this._right)this._children.push(t);else{const e=this._partitionMethod.split([t]);e.left.length>0&&this._left.addChild(e.left[0]),e.right.length>0&&this._right.addChild(e.right[0])}}getPartitionMethod(){return this._partitionMethod}getLeft(){return this._left}getRight(){return this._right}getDepth(){return this._depth}setDepth(t){this._depth=t}}e.default=s},4499:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Partition2D=e.BoundingBox=e.PartitionTreeNode=void 0;const r=s(5462);e.BoundingBox=r.default;const i=s(4683);e.Partition2D=i.default;const n=s(8955);e.PartitionTreeNode=n.default},557:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{_maxWeight=0;_maxItems=0;_items=[];constructor(){this.reset(0,0)}reset(t,e){this.maxWeight=e,this.maxItems=t,this._items=[]}add(t){return this.remainingSpace>0&&this.remainingWeight>=t.weight&&(this._items.push(t),!0)}getAllByCategory(t){return this._items.filter((e=>e.category===t))}getAllCategories(){const t=this._items.map((t=>t.category)),e=new Set(t);return Array.from(e)}getAllGroupByCategory(){return this.getAllCategories().map((t=>({category:t,items:this.getAllByCategory(t)})))}remove(t){const e=this._items.indexOf(t);return e>-1?(this._items.splice(e,1),t):null}contains(t){return this._items.indexOf(t)>-1}get remainingSpace(){return this.maxItems-this._items.length}get totalWeight(){let t=0;for(let e of this._items)t+=e.weight;return t}get numItems(){return this._items.length}get remainingWeight(){return this.maxWeight-this.totalWeight}get maxWeight(){return this._maxWeight}set maxWeight(t){this._maxWeight=t<0?0:t}get maxItems(){return this._maxItems}set maxItems(t){this._maxItems=t<0?0:t}}},1035:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Inventory=void 0;const r=s(557);e.Inventory=r.default},5430:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(8791),i=s(9510),n=s(8126);e.default=class{_grid=null;_pathCoords;_currentRow=0;_currentCol=0;reset(t,e,s,o){this._pathCoords=[],this._grid=new r.Grid2D,this._grid.reset(t,e),this._currentRow=s,this._currentCol=o,this._grid.forEach(((t,e,s)=>{const r=new i.GameNode;r.state.type=e%2==0||s%2==0?n.default.WALL:n.default.BLOCK,this._grid.addAt(e,s,r)}))}getRows(){return this._grid.numRows}getCols(){return this._grid.numCols}getCurrentNode(){return this._grid.getAt(this._currentRow,this._currentCol)}getData(){return this._grid.data}isFinished(){return null===this._currentRow&&null===this._currentCol}finalize(){for(;!this.isFinished();)this.step()}step(){if(this.isFinished())return;const t=this._grid,e=this._pathCoords,s=this._currentRow,r=this._currentCol;t.getAt(s,r).state.type=n.default.FREE;const i=[{wall:this._grid.getLeft(s,r),target:this._grid.getLeft(s,r-1),row:s,col:r-2},{wall:this._grid.getRight(s,r),target:this._grid.getRight(s,r+1),row:s,col:r+2},{wall:this._grid.getTop(s,r),target:this._grid.getTop(s-1,r),row:s-2,col:r},{wall:this._grid.getBottom(s,r),target:this._grid.getBottom(s+1,r),row:s+2,col:r}].filter((t=>null!==t.wall&&null!==t.target&&t.target.state.type===n.default.BLOCK));if(i.length>0){const t=i[Math.round(Math.random()*(i.length-1))];t.wall.state.type=n.default.FREE,t.target.state.type=n.default.FREE,e.push([s,r]),this._currentRow=t.row,this._currentCol=t.col}else if(e.length>0){let t=e.pop();this._currentRow=t[0],this._currentCol=t[1]}else this._currentRow=null,this._currentCol=null}}},4781:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(8791),i=s(9510),n=s(8126);e.default=class{_grid=null;_pathCoords;_currentRow=0;_currentCol=0;_currentLayer=0;reset(t,e,s,o,a,h){this._pathCoords=[],this._grid=new r.Grid3D,this._grid.reset(t,e,s),this._currentRow=o,this._currentCol=a,this._currentLayer=h,this._grid.forEach(((t,e,s,r)=>{const o=new i.GameNode;o.state.type=e%2==0||s%2==0||r%2==0?n.default.WALL:n.default.BLOCK,this._grid.addAt(e,s,r,o)}))}getRows(){return this._grid.numRows}getCols(){return this._grid.numCols}getLayers(){return this._grid.numLayers}getCurrentNode(){return this._grid.getAt(this._currentRow,this._currentCol,this._currentLayer)}getData(){return this._grid.data}isFinished(){return null===this._currentRow&&null===this._currentCol&&null===this._currentLayer}finalize(){for(;!this.isFinished();)this.step()}step(){if(this.isFinished())return;const t=this._grid,e=this._pathCoords,s=this._currentRow,r=this._currentCol,i=this._currentLayer;t.getAt(s,r,i).state.type=n.default.FREE;const o=[{wall:this._grid.getAt(s,r-1,i),target:this._grid.getAt(s,r-2,i),row:s,col:r-2,layer:i},{wall:this._grid.getAt(s,r+1,i),target:this._grid.getAt(s,r+2,i),row:s,col:r+2,layer:i},{wall:this._grid.getAt(s-1,r,i),target:this._grid.getAt(s-2,r,i),row:s-2,col:r,layer:i},{wall:this._grid.getAt(s+1,r,i),target:this._grid.getAt(s+2,r,i),row:s+2,col:r,layer:i},{wall:this._grid.getAt(s,r,i-1),target:this._grid.getAt(s,r,i-2),row:s,col:r,layer:i-2},{wall:this._grid.getAt(s,r,i+1),target:this._grid.getAt(s,r,i+2),row:s,col:r,layer:i+2}].filter((t=>null!==t.wall&&null!==t.target&&t.target.state.type===n.default.BLOCK));if(o.length>0){const t=o[Math.round(Math.random()*(o.length-1))];t.wall.state.type=n.default.FREE,t.target.state.type=n.default.FREE,e.push([s,r,i]),this._currentRow=t.row,this._currentCol=t.col,this._currentLayer=t.layer}else if(e.length>0){let t=e.pop();this._currentRow=t[0],this._currentCol=t[1],this._currentLayer=t[2]}else this._currentRow=null,this._currentCol=null,this._currentLayer=null}}},8126:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.WALL="WALL",t.FREE="FREE",t.BLOCK="BLOCK"}(s||(s={})),e.default=s},3078:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NODE_DISTANCE_VALUE=void 0;const r=s(8791),i=s(9510);e.default=class{opened=[];closed=[];createGraphe(t,e){const s=new r.Grid2D;return s.reset(t.numRows,t.numCols),t.forEach(((t,r,n)=>{const o=new i.GameNode;o.state.row=r,o.state.col=n,o.state.g=0,o.state.f=0,o.state.h=0,o.state.walkable=t===e,o.state.parent=null,s.addAt(r,n,o)})),s}resetGraphe(t){this.opened=new Array,this.closed=new Array,t.forEach(((t,e,s)=>{t&&(t.state.row=e,t.state.col=s,t.state.g=0,t.state.f=0,t.state.h=0,t.state.parent=null)}))}findPath(t,s,r,i=!1){this.opened=new Array,this.closed=new Array,this._addToOpenList(s);let n=!0;for(;n;){if(this.opened.sort(((t,e)=>t.state.f<e.state.f?-1:1)),0===this.opened.length||this.opened[0]===r){n=!1;break}const s=this.opened[0];this._addToCloseList(s);const o=[t.getLeft(s.state.row,s.state.col),t.getRight(s.state.row,s.state.col),t.getTop(s.state.row,s.state.col),t.getBottom(s.state.row,s.state.col)];i&&o.push(t.getTopLeft(s.state.row,s.state.col),t.getTopRight(s.state.row,s.state.col),t.getBottomLeft(s.state.row,s.state.col),t.getBottomRight(s.state.row,s.state.col)),o.filter((t=>null!==t)).forEach((t=>{if(this._isOnCloseList(t)||!t.state||!t.state.walkable)return;const i=this._isOnOpenList(t),n=s.state.g+e.NODE_DISTANCE_VALUE,o=(Math.abs(r.state.row-t.state.row)+Math.abs(r.state.col-t.state.col))*e.NODE_DISTANCE_VALUE,a=o+n;(i&&n<t.state.g||!i)&&(t.state.parent=s,t.state.g=n,t.state.h=o,t.state.f=a,i||this._addToOpenList(t))}))}const o=[];if(this.opened.length>0){let t=r;for(;t!=s;)o.unshift(t),t=t.state.parent;o.unshift(s)}return o}_addToCloseList(t){const e=this.opened.indexOf(t);e>-1&&this.opened.splice(e,1),this.closed.push(t)}_addToOpenList(t){const e=this.closed.indexOf(t);e>-1&&this.closed.splice(e,1),this.opened.push(t)}_isOnOpenList(t){return this.opened.indexOf(t)>-1}_isOnCloseList(t){return this.closed.indexOf(t)>-1}},e.NODE_DISTANCE_VALUE=10},6217:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NODE_DISTANCE_VALUE=void 0;const r=s(8791),i=s(9510);e.default=class{opened=[];closed=[];createGraphe(t,e){const s=new r.Grid3D;return s.reset(t.numRows,t.numCols,t.numLayers),t.forEach(((t,r,n,o)=>{const a=new i.GameNode;a.state.row=r,a.state.col=n,a.state.layer=o,a.state.g=0,a.state.f=0,a.state.h=0,a.state.walkable=t===e,a.state.parent=null,s.addAt(r,n,o,a)})),s}resetGraphe(t){this.opened=new Array,this.closed=new Array,t.forEach(((t,e,s,r)=>{t&&(t.state.row=e,t.state.col=s,t.state.layer=r,t.state.g=0,t.state.f=0,t.state.h=0,t.state.parent=null)}))}findPath(t,s,r,i=!1){this.opened=new Array,this.closed=new Array,this._addToOpenList(s);let n=!0;for(;n;){if(this.opened.sort(((t,e)=>t.state.f<e.state.f?-1:1)),0===this.opened.length||this.opened[0]===r){n=!1;break}const s=this.opened[0];this._addToCloseList(s);const o=[t.getLeft(s.state.row,s.state.col,s.state.layer),t.getRight(s.state.row,s.state.col,s.state.layer),t.getTop(s.state.row,s.state.col,s.state.layer),t.getBottom(s.state.row,s.state.col,s.state.layer),t.getBack(s.state.row,s.state.col,s.state.layer),t.getFront(s.state.row,s.state.col,s.state.layer)];i&&o.push(t.getTopLeftBack(s.state.row,s.state.col,s.state.layer),t.getTopRightBack(s.state.row,s.state.col,s.state.layer),t.getBottomLeftBack(s.state.row,s.state.col,s.state.layer),t.getBottomRightBack(s.state.row,s.state.col,s.state.layer),t.getTopLeftFront(s.state.row,s.state.col,s.state.layer),t.getTopRightFront(s.state.row,s.state.col,s.state.layer),t.getBottomLeftFront(s.state.row,s.state.col,s.state.layer),t.getBottomRightFront(s.state.row,s.state.col,s.state.layer),t.getTopLeft(s.state.row,s.state.col,s.state.layer),t.getTopRight(s.state.row,s.state.col,s.state.layer),t.getBottomLeft(s.state.row,s.state.col,s.state.layer),t.getBottomRight(s.state.row,s.state.col,s.state.layer)),o.filter((t=>null!==t)).forEach((t=>{if(this._isOnCloseList(t)||!t.state||!t.state.walkable)return;const i=this._isOnOpenList(t),n=s.state.g+e.NODE_DISTANCE_VALUE,o=(Math.abs(r.state.row-t.state.row)+Math.abs(r.state.col-t.state.col)+Math.abs(r.state.layer-t.state.layer))*e.NODE_DISTANCE_VALUE,a=o+n;(i&&n<t.state.g||!i)&&(t.state.parent=s,t.state.g=n,t.state.h=o,t.state.f=a,i||this._addToOpenList(t))}))}const o=[];if(this.opened.length>0){let t=r;for(;t!=s;)o.unshift(t),t=t.state.parent;o.unshift(s)}return o}_addToCloseList(t){const e=this.opened.indexOf(t);e>-1&&this.opened.splice(e,1),this.closed.push(t)}_addToOpenList(t){const e=this.closed.indexOf(t);e>-1&&this.closed.splice(e,1),this.opened.push(t)}_isOnOpenList(t){return this.opened.indexOf(t)>-1}_isOnCloseList(t){return this.closed.indexOf(t)>-1}},e.NODE_DISTANCE_VALUE=10},9170:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(5003);class i extends r.Emitter{_states=[];_current=null;_timestamp=0;static ON_COMPLETE_ACTION="ON_COMPLETE_ACTION";setTime(t){this._timestamp=t;const e=this.getCurrentState();if(null===e||null===e.onCompleteAction)return;const s=e.duration||0,r=e.lockDuration||0,i=Math.max(s,r);this.getElapsedTime()<i||this.emit("ON_COMPLETE_ACTION",e.onCompleteAction)}getTime(){return this._timestamp}addState(t){this._states.push(t)}removeState(t){this._states.splice(this._states.indexOf(t),1)}reset(){this._current=null,this._states=[]}hasState(t){return null!==this.getStateById(t)}getStateById(t){return this._states.find((e=>e.id===t))||null}getElapsedTime(){const t=this.getCurrentState();return null===t?-1:this._timestamp-t.startTime}dispatch(t){const e=this.getCurrentState();if(null===e)return;if(this._timestamp-e.startTime<e.lockDuration)return;const s=e.actions.find((e=>e.name===t))||null;if(null===s)return;const r=this.getStateById(s.target);r!==e&&(this.setCurrentState(r),this.emit("CHANGE_STATE",r))}getCurrentState(){return this._current||null}setCurrentState(t){this.hasState(t.id)||this.addState(t),t.startTime=this._timestamp,this._current=t}getStates(){return this._states}}e.default=i},5794:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FiniteStateMachine=void 0;const r=s(9170);e.FiniteStateMachine=r.default},2576:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PathFinder3D=e.PathFinder2D=e.MazeNodeType=e.Maze3D=e.Maze2D=void 0;const r=s(5430);e.Maze2D=r.default;const i=s(4781);e.Maze3D=i.default;const n=s(8126);e.MazeNodeType=n.default;const o=s(3078);e.PathFinder2D=o.default;const a=s(6217);e.PathFinder3D=a.default},7072:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.makeIsometric=void 0;const r=s(5587);e.makeIsometric=r.default},5587:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(5084);e.default=function(t){return class extends t{isoNode=new r.default;constructor(...t){super(...t)}syncWithNode(){null!==this.isoNode&&(this.y=this.isoNode.isoY-this.isoNode.isoZ-this.isoNode.offsetY,this.x=this.isoNode.isoX-this.isoNode.offsetX)}}}},5084:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(1777),i=s(7690);class n extends i.default{isoX=0;isoY=0;isoZ=0;row=0;col=0;cellWidth=64;cellHeight=32;width=64;height=64;get offsetY(){return this.height-this.cellHeight}get offsetX(){return this.width-this.cellWidth>>1}resetRowAndColFromCoordinates(){const t=r.screenToIso(this.isoX,this.isoY,this.cellWidth,this.cellHeight);this.col=t.col,this.row=t.row}resetCoordinatesFromRowAndCol(){const t=r.isoToScreen(this.row,this.col,this.cellWidth,this.cellHeight);this.isoX=t.x,this.isoY=t.y,this.isoZ=0}}e.default=n},2677:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IsoNode=void 0;const r=s(5084);e.IsoNode=r.default},3407:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.screenToIso=e.isoToScreen=e.isoSort=void 0;const r=s(1777);Object.defineProperty(e,"isoSort",{enumerable:!0,get:function(){return r.isoSort}}),Object.defineProperty(e,"isoToScreen",{enumerable:!0,get:function(){return r.isoToScreen}}),Object.defineProperty(e,"screenToIso",{enumerable:!0,get:function(){return r.screenToIso}})},1777:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isoSort=e.isoToScreen=e.screenToIso=void 0,e.screenToIso=function(t,e,s,r){let i={row:0,col:0},n=e/r,o=t/s;return i.col=n+o,i.row=n-o,i},e.isoToScreen=function(t,e,s,r){return{x:.5*s*(e-t)>>0,y:(e+t)*(.5*r)>>0}},e.isoSort=function(t,e){return t.isoNode&&e.isoNode?t.isoNode.isoY===e.isoNode.isoY?t.isoNode.isoZ<e.isoNode.isoZ?-1:1:t.isoNode.isoY<e.isoNode.isoY?-1:1:-1}},5043:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=s(5055),i=s(1777);class n extends r.default{sortAuto=!1;sort(){this.getChildren().sort(i.isoSort)}render(t){this.sortAuto&&this.sort(),super.render(t)}}e.default=n},8433:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IsoMap=void 0;const r=s(5043);e.IsoMap=r.default},5003:t=>{t.exports=require("@thetinyspark/tiny-observer")},5747:t=>{t.exports=require("fs")},925:t=>{t.exports=require("gl-matrix")}},e={};!function s(r){var i=e[r];if(void 0!==i)return i.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,s),n.exports}(5590)})();